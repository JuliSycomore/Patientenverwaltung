{"ast":null,"code":"// src/components/ICD11ECTBrowser.js\nimport React,{useEffect,useRef,useState}from'react';import*as ECT from'@whoicd/icd11ect';import'@whoicd/icd11ect/style.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ICD11ECTBrowser=_ref=>{let{patients,selectedPatient,onAssignDiagnosis}=_ref;const isInitialized=useRef(false);const[activeFilter,setActiveFilter]=useState(null);const[selectedIcd11Entity,setSelectedIcd11Entity]=useState(null);const[targetPatientId,setTargetPatientId]=useState('');useEffect(()=>{if(selectedPatient){setTargetPatientId(selectedPatient.id);}},[selectedPatient]);useEffect(()=>{if(isInitialized.current)return;isInitialized.current=true;const mySettings={apiServerUrl:\"https://id.who.int\",apiSecured:true,language:\"en\",browserHierarchyAvailable:true,browserAdvancedSearchAvailable:true,includeDiagnosticCriteria:true,hierarchyResizable:true,height:\"70vh\",autoBind:false};const myCallbacks={getNewTokenFunction:async()=>{try{const response=await fetch('http://localhost:3001/api/icd11-token');if(!response.ok)return null;const result=await response.json();return result.token;}catch(e){console.error(\"Fehler bei der Token-Anfrage:\",e);return null;}},selectedEntityFunction:selectedEntity=>{console.log(\"Ausgewählte Entität:\",selectedEntity);// Zum Debuggen\nsetSelectedIcd11Entity(selectedEntity);}};ECT.Handler.configure(mySettings,myCallbacks);setTimeout(()=>{ECT.Handler.bind(\"1\");},100);},[]);const handleFilterChange=newFilter=>{if(isInitialized.current&&ECT){setActiveFilter(newFilter);ECT.Handler.overwriteConfiguration(\"1\",{chaptersFilter:newFilter||\"\"});}};const handleAssignClick=()=>{if(targetPatientId&&selectedIcd11Entity){onAssignDiagnosis(targetPatientId,selectedIcd11Entity);alert(\"Diagnose \\\"\".concat(selectedIcd11Entity.selectedText,\"\\\" wurde dem Patienten zugewiesen.\"));setSelectedIcd11Entity(null);}};const filterButtons=[{label:\"Alle Kapitel\",filter:null},{label:\"Psychische Störungen (06)\",filter:\"06\"},{label:\"Neurolog. Störungen (08)\",filter:\"08\"},{label:\"Schlaf-Wach-Störungen (07)\",filter:\"07\"}];return/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-white rounded-lg shadow-lg\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-semibold text-gray-800 mb-4\",children:\"ICD-11 Nachschlagewerk & Kodierung\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-2 mb-4\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-semibold self-center text-gray-600\",children:\"Schnellfilter:\"}),filterButtons.map(_ref2=>{let{label,filter}=_ref2;return/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleFilterChange(filter),className:\"px-3 py-1 text-sm rounded-full transition-colors \".concat(activeFilter===filter?'bg-indigo-600 text-white shadow':'bg-gray-200 text-gray-700 hover:bg-gray-300'),children:label},label);})]}),/*#__PURE__*/_jsx(\"div\",{className:\"ctw-eb-window\",\"data-ctw-ino\":\"1\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 p-4 border-t-2 border-indigo-200 bg-indigo-50 rounded-b-lg\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-lg text-gray-800 mb-2\",children:\"Auswahl zuweisen\"}),selectedIcd11Entity?/*#__PURE__*/_jsxs(\"div\",{className:\"p-2 bg-white rounded shadow-sm mb-3\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold text-sm\",children:\"Ausgew\\xE4hlt:\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-indigo-700 font-mono\",children:[selectedIcd11Entity.code,\" - \",selectedIcd11Entity.selectedText]})]}):/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 mb-3\",children:\"Bitte w\\xE4hlen Sie eine Diagnose aus dem Browser oben aus.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsxs(\"select\",{value:targetPatientId,onChange:e=>setTargetPatientId(e.target.value),className:\"mt-1 block w-full md:w-1/2 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm h-10 px-3\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",disabled:true,children:\"Patient ausw\\xE4hlen...\"}),patients.map(p=>/*#__PURE__*/_jsxs(\"option\",{value:p.id,children:[p.name,\" (\",p.chiffre,\")\"]},p.id))]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleAssignClick,disabled:!targetPatientId||!selectedIcd11Entity,className:\"bg-green-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed\",children:\"Zuweisen\"})]})]})]});};export default ICD11ECTBrowser;","map":{"version":3,"names":["React","useEffect","useRef","useState","ECT","jsx","_jsx","jsxs","_jsxs","ICD11ECTBrowser","_ref","patients","selectedPatient","onAssignDiagnosis","isInitialized","activeFilter","setActiveFilter","selectedIcd11Entity","setSelectedIcd11Entity","targetPatientId","setTargetPatientId","id","current","mySettings","apiServerUrl","apiSecured","language","browserHierarchyAvailable","browserAdvancedSearchAvailable","includeDiagnosticCriteria","hierarchyResizable","height","autoBind","myCallbacks","getNewTokenFunction","response","fetch","ok","result","json","token","e","console","error","selectedEntityFunction","selectedEntity","log","Handler","configure","setTimeout","bind","handleFilterChange","newFilter","overwriteConfiguration","chaptersFilter","handleAssignClick","alert","concat","selectedText","filterButtons","label","filter","className","children","map","_ref2","onClick","code","value","onChange","target","disabled","p","name","chiffre"],"sources":["/Users/julianrogowski/Documents/Visual Code/patientenverwaltung-app/src/components/ICD11ECTBrowser.js"],"sourcesContent":["// src/components/ICD11ECTBrowser.js\nimport React, { useEffect, useRef, useState } from 'react';\nimport * as ECT from '@whoicd/icd11ect';\nimport '@whoicd/icd11ect/style.css';\n\nconst ICD11ECTBrowser = ({ patients, selectedPatient, onAssignDiagnosis }) => {\n    const isInitialized = useRef(false);\n    const [activeFilter, setActiveFilter] = useState(null);\n    const [selectedIcd11Entity, setSelectedIcd11Entity] = useState(null);\n    const [targetPatientId, setTargetPatientId] = useState('');\n\n    useEffect(() => {\n        if (selectedPatient) {\n            setTargetPatientId(selectedPatient.id);\n        }\n    }, [selectedPatient]);\n\n    useEffect(() => {\n        if (isInitialized.current) return;\n        isInitialized.current = true;\n\n        const mySettings = {\n            apiServerUrl: \"https://id.who.int\",\n            apiSecured: true,\n            language: \"en\",\n            browserHierarchyAvailable: true,\n            browserAdvancedSearchAvailable: true,\n            includeDiagnosticCriteria: true,\n            hierarchyResizable: true,\n            height: \"70vh\",\n            autoBind: false\n        };\n\n        const myCallbacks = {\n            getNewTokenFunction: async () => {\n                try {\n                    const response = await fetch('http://localhost:3001/api/icd11-token');\n                    if (!response.ok) return null;\n                    const result = await response.json();\n                    return result.token;\n                } catch (e) {\n                    console.error(\"Fehler bei der Token-Anfrage:\", e);\n                    return null;\n                }\n            },\n            selectedEntityFunction: (selectedEntity) => {\n                console.log(\"Ausgewählte Entität:\", selectedEntity); // Zum Debuggen\n                setSelectedIcd11Entity(selectedEntity);\n            }\n        };\n        \n        ECT.Handler.configure(mySettings, myCallbacks);\n        setTimeout(() => { ECT.Handler.bind(\"1\"); }, 100);\n        \n    }, []); \n\n    const handleFilterChange = (newFilter) => {\n        if (isInitialized.current && ECT) {\n            setActiveFilter(newFilter);\n            ECT.Handler.overwriteConfiguration(\"1\", { chaptersFilter: newFilter || \"\" });\n        }\n    };\n    \n    const handleAssignClick = () => {\n        if (targetPatientId && selectedIcd11Entity) {\n            onAssignDiagnosis(targetPatientId, selectedIcd11Entity);\n            alert(`Diagnose \"${selectedIcd11Entity.selectedText}\" wurde dem Patienten zugewiesen.`);\n            setSelectedIcd11Entity(null);\n        }\n    };\n\n    const filterButtons = [\n        { label: \"Alle Kapitel\", filter: null },\n        { label: \"Psychische Störungen (06)\", filter: \"06\" },\n        { label: \"Neurolog. Störungen (08)\", filter: \"08\" },\n        { label: \"Schlaf-Wach-Störungen (07)\", filter: \"07\"},\n    ];\n\n    return (\n        <div className=\"p-4 bg-white rounded-lg shadow-lg\">\n             <h2 className=\"text-2xl font-semibold text-gray-800 mb-4\">ICD-11 Nachschlagewerk & Kodierung</h2>\n            <div className=\"flex flex-wrap gap-2 mb-4\">\n                <span className=\"text-sm font-semibold self-center text-gray-600\">Schnellfilter:</span>\n                {filterButtons.map(({label, filter}) => (\n                     <button \n                        key={label}\n                        onClick={() => handleFilterChange(filter)}\n                        className={`px-3 py-1 text-sm rounded-full transition-colors ${activeFilter === filter ? 'bg-indigo-600 text-white shadow' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}\n                     >\n                        {label}\n                     </button>\n                ))}\n            </div>\n            \n            <div className=\"ctw-eb-window\" data-ctw-ino=\"1\"></div>\n\n            <div className=\"mt-4 p-4 border-t-2 border-indigo-200 bg-indigo-50 rounded-b-lg\">\n                <h3 className=\"font-semibold text-lg text-gray-800 mb-2\">Auswahl zuweisen</h3>\n                {selectedIcd11Entity ? (\n                    <div className=\"p-2 bg-white rounded shadow-sm mb-3\">\n                        <p className=\"font-semibold text-sm\">Ausgewählt:</p>\n                        <p className=\"text-indigo-700 font-mono\">{selectedIcd11Entity.code} - {selectedIcd11Entity.selectedText}</p>\n                    </div>\n                ) : (\n                    <p className=\"text-sm text-gray-500 mb-3\">Bitte wählen Sie eine Diagnose aus dem Browser oben aus.</p>\n                )}\n\n                <div className=\"flex items-center gap-4\">\n                    <select value={targetPatientId} onChange={(e) => setTargetPatientId(e.target.value)} className=\"mt-1 block w-full md:w-1/2 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm h-10 px-3\">\n                        <option value=\"\" disabled>Patient auswählen...</option>\n                        {patients.map(p => ( <option key={p.id} value={p.id}>{p.name} ({p.chiffre})</option> ))}\n                    </select>\n                    <button onClick={handleAssignClick} disabled={!targetPatientId || !selectedIcd11Entity} className=\"bg-green-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed\">\n                        Zuweisen\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default ICD11ECTBrowser;\n"],"mappings":"AAAA;AACA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,MAAM,CAAEC,QAAQ,KAAQ,OAAO,CAC1D,MAAO,GAAK,CAAAC,GAAG,KAAM,kBAAkB,CACvC,MAAO,4BAA4B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEpC,KAAM,CAAAC,eAAe,CAAGC,IAAA,EAAsD,IAArD,CAAEC,QAAQ,CAAEC,eAAe,CAAEC,iBAAkB,CAAC,CAAAH,IAAA,CACrE,KAAM,CAAAI,aAAa,CAAGZ,MAAM,CAAC,KAAK,CAAC,CACnC,KAAM,CAACa,YAAY,CAAEC,eAAe,CAAC,CAAGb,QAAQ,CAAC,IAAI,CAAC,CACtD,KAAM,CAACc,mBAAmB,CAAEC,sBAAsB,CAAC,CAAGf,QAAQ,CAAC,IAAI,CAAC,CACpE,KAAM,CAACgB,eAAe,CAAEC,kBAAkB,CAAC,CAAGjB,QAAQ,CAAC,EAAE,CAAC,CAE1DF,SAAS,CAAC,IAAM,CACZ,GAAIW,eAAe,CAAE,CACjBQ,kBAAkB,CAACR,eAAe,CAACS,EAAE,CAAC,CAC1C,CACJ,CAAC,CAAE,CAACT,eAAe,CAAC,CAAC,CAErBX,SAAS,CAAC,IAAM,CACZ,GAAIa,aAAa,CAACQ,OAAO,CAAE,OAC3BR,aAAa,CAACQ,OAAO,CAAG,IAAI,CAE5B,KAAM,CAAAC,UAAU,CAAG,CACfC,YAAY,CAAE,oBAAoB,CAClCC,UAAU,CAAE,IAAI,CAChBC,QAAQ,CAAE,IAAI,CACdC,yBAAyB,CAAE,IAAI,CAC/BC,8BAA8B,CAAE,IAAI,CACpCC,yBAAyB,CAAE,IAAI,CAC/BC,kBAAkB,CAAE,IAAI,CACxBC,MAAM,CAAE,MAAM,CACdC,QAAQ,CAAE,KACd,CAAC,CAED,KAAM,CAAAC,WAAW,CAAG,CAChBC,mBAAmB,CAAE,KAAAA,CAAA,GAAY,CAC7B,GAAI,CACA,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAAC,uCAAuC,CAAC,CACrE,GAAI,CAACD,QAAQ,CAACE,EAAE,CAAE,MAAO,KAAI,CAC7B,KAAM,CAAAC,MAAM,CAAG,KAAM,CAAAH,QAAQ,CAACI,IAAI,CAAC,CAAC,CACpC,MAAO,CAAAD,MAAM,CAACE,KAAK,CACvB,CAAE,MAAOC,CAAC,CAAE,CACRC,OAAO,CAACC,KAAK,CAAC,+BAA+B,CAAEF,CAAC,CAAC,CACjD,MAAO,KAAI,CACf,CACJ,CAAC,CACDG,sBAAsB,CAAGC,cAAc,EAAK,CACxCH,OAAO,CAACI,GAAG,CAAC,sBAAsB,CAAED,cAAc,CAAC,CAAE;AACrD3B,sBAAsB,CAAC2B,cAAc,CAAC,CAC1C,CACJ,CAAC,CAEDzC,GAAG,CAAC2C,OAAO,CAACC,SAAS,CAACzB,UAAU,CAAEU,WAAW,CAAC,CAC9CgB,UAAU,CAAC,IAAM,CAAE7C,GAAG,CAAC2C,OAAO,CAACG,IAAI,CAAC,GAAG,CAAC,CAAE,CAAC,CAAE,GAAG,CAAC,CAErD,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAC,kBAAkB,CAAIC,SAAS,EAAK,CACtC,GAAItC,aAAa,CAACQ,OAAO,EAAIlB,GAAG,CAAE,CAC9BY,eAAe,CAACoC,SAAS,CAAC,CAC1BhD,GAAG,CAAC2C,OAAO,CAACM,sBAAsB,CAAC,GAAG,CAAE,CAAEC,cAAc,CAAEF,SAAS,EAAI,EAAG,CAAC,CAAC,CAChF,CACJ,CAAC,CAED,KAAM,CAAAG,iBAAiB,CAAGA,CAAA,GAAM,CAC5B,GAAIpC,eAAe,EAAIF,mBAAmB,CAAE,CACxCJ,iBAAiB,CAACM,eAAe,CAAEF,mBAAmB,CAAC,CACvDuC,KAAK,eAAAC,MAAA,CAAcxC,mBAAmB,CAACyC,YAAY,sCAAmC,CAAC,CACvFxC,sBAAsB,CAAC,IAAI,CAAC,CAChC,CACJ,CAAC,CAED,KAAM,CAAAyC,aAAa,CAAG,CAClB,CAAEC,KAAK,CAAE,cAAc,CAAEC,MAAM,CAAE,IAAK,CAAC,CACvC,CAAED,KAAK,CAAE,2BAA2B,CAAEC,MAAM,CAAE,IAAK,CAAC,CACpD,CAAED,KAAK,CAAE,0BAA0B,CAAEC,MAAM,CAAE,IAAK,CAAC,CACnD,CAAED,KAAK,CAAE,4BAA4B,CAAEC,MAAM,CAAE,IAAI,CAAC,CACvD,CAED,mBACIrD,KAAA,QAAKsD,SAAS,CAAC,mCAAmC,CAAAC,QAAA,eAC7CzD,IAAA,OAAIwD,SAAS,CAAC,2CAA2C,CAAAC,QAAA,CAAC,oCAAkC,CAAI,CAAC,cAClGvD,KAAA,QAAKsD,SAAS,CAAC,2BAA2B,CAAAC,QAAA,eACtCzD,IAAA,SAAMwD,SAAS,CAAC,iDAAiD,CAAAC,QAAA,CAAC,gBAAc,CAAM,CAAC,CACtFJ,aAAa,CAACK,GAAG,CAACC,KAAA,MAAC,CAACL,KAAK,CAAEC,MAAM,CAAC,CAAAI,KAAA,oBAC9B3D,IAAA,WAEG4D,OAAO,CAAEA,CAAA,GAAMf,kBAAkB,CAACU,MAAM,CAAE,CAC1CC,SAAS,qDAAAL,MAAA,CAAsD1C,YAAY,GAAK8C,MAAM,CAAG,iCAAiC,CAAG,6CAA6C,CAAG,CAAAE,QAAA,CAE5KH,KAAK,EAJDA,KAKA,CAAC,EACb,CAAC,EACD,CAAC,cAENtD,IAAA,QAAKwD,SAAS,CAAC,eAAe,CAAC,eAAa,GAAG,CAAM,CAAC,cAEtDtD,KAAA,QAAKsD,SAAS,CAAC,iEAAiE,CAAAC,QAAA,eAC5EzD,IAAA,OAAIwD,SAAS,CAAC,0CAA0C,CAAAC,QAAA,CAAC,kBAAgB,CAAI,CAAC,CAC7E9C,mBAAmB,cAChBT,KAAA,QAAKsD,SAAS,CAAC,qCAAqC,CAAAC,QAAA,eAChDzD,IAAA,MAAGwD,SAAS,CAAC,uBAAuB,CAAAC,QAAA,CAAC,gBAAW,CAAG,CAAC,cACpDvD,KAAA,MAAGsD,SAAS,CAAC,2BAA2B,CAAAC,QAAA,EAAE9C,mBAAmB,CAACkD,IAAI,CAAC,KAAG,CAAClD,mBAAmB,CAACyC,YAAY,EAAI,CAAC,EAC3G,CAAC,cAENpD,IAAA,MAAGwD,SAAS,CAAC,4BAA4B,CAAAC,QAAA,CAAC,6DAAwD,CAAG,CACxG,cAEDvD,KAAA,QAAKsD,SAAS,CAAC,yBAAyB,CAAAC,QAAA,eACpCvD,KAAA,WAAQ4D,KAAK,CAAEjD,eAAgB,CAACkD,QAAQ,CAAG5B,CAAC,EAAKrB,kBAAkB,CAACqB,CAAC,CAAC6B,MAAM,CAACF,KAAK,CAAE,CAACN,SAAS,CAAC,oIAAoI,CAAAC,QAAA,eAC/NzD,IAAA,WAAQ8D,KAAK,CAAC,EAAE,CAACG,QAAQ,MAAAR,QAAA,CAAC,yBAAoB,CAAQ,CAAC,CACtDpD,QAAQ,CAACqD,GAAG,CAACQ,CAAC,eAAMhE,KAAA,WAAmB4D,KAAK,CAAEI,CAAC,CAACnD,EAAG,CAAA0C,QAAA,EAAES,CAAC,CAACC,IAAI,CAAC,IAAE,CAACD,CAAC,CAACE,OAAO,CAAC,GAAC,GAAzCF,CAAC,CAACnD,EAA+C,CAAG,CAAC,EACnF,CAAC,cACTf,IAAA,WAAQ4D,OAAO,CAAEX,iBAAkB,CAACgB,QAAQ,CAAE,CAACpD,eAAe,EAAI,CAACF,mBAAoB,CAAC6C,SAAS,CAAC,0IAA0I,CAAAC,QAAA,CAAC,UAE7O,CAAQ,CAAC,EACR,CAAC,EACL,CAAC,EACL,CAAC,CAEd,CAAC,CAED,cAAe,CAAAtD,eAAe","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}